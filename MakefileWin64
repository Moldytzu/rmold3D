rwildcard=$(foreach d,$(wildcard $(1:=/*)),$(call rwildcard,$d,$2) $(filter $(subst *,%,$2),$d))
reverse = $(if $(1),$(call reverse,$(wordlist 2,$(words $(1)),$(1)))) $(firstword $(1))

CPP = C:\msys64\mingw64\bin\g++
CC = C:\msys64\mingw64\bin\gcc

SRCDIR := rmold3D
OBJDIR := obj

CFLAGS = -I.\ -I.\rmold3D -I.\rmold3D\3rd-Party\glm -O0 -g -std=c++17 -Wno-volatile -Werror

SRC = $(call rwildcard,$(SRCDIR),*.cpp)  
OBJS = $(patsubst $(SRCDIR)/%.cpp, $(OBJDIR)/%.o, $(SRC))

LIB = engrmold3D.a

$(OBJDIR)/%.o: $(SRCDIR)/%.cpp
	cmd /C "cmd /C if not exist .\$(subst /,\\,$(@D)) md .\$(subst /,\\,$(@D))"
	$(CPP) $(CFLAGS) -c $^ -o $@

.PHONY: build
build: lib

clean:
	rm -rf $(OBJS)

lib: $(OBJS)
	C:\msys64\mingw64\bin\ar -crs $(LIB) $(OBJS)

define buildGame
	$(CPP) $(1) $(LIB) -lglfw3 -o game $(CFLAGS)
endef

game: lib 
	$(call buildGame,game.cpp)

cubes: lib 
	$(call buildGame,cubes.cpp)